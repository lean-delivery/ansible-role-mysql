---
- name: "Add repository and install packages"
  block:
    - name: "Add {{ mysql_daemon }} {{ mysql_version }} YUM repository file"
      yum_repository:
        name: "{{ mysql_daemon }}"
        description: "mysql YUM repo"
        baseurl: "{{ mysql_repo }}"
        gpgcakey: "{{ mysql_gpgkey }}"
        gpgcheck: True
      register: task_result
      until: task_result is success
      retries: 10
      delay: 2

    - name: "Add gpgkey"
      rpm_key:
        state: present
        key: "{{ mysql_gpgkey }}"
      register: task_result
      until: task_result is success
      retries: 10
      delay: 2

    - name: "Ensure MySQL Python libraries are installed."
      yum:
        name: "{{ mysql_python_packages }}"
        state: present
      register: task_result
      until: task_result is success
      retries: 10
      delay: 2

    - name: "Install {{ mysql_daemon }} {{ mysql_version }} packages."
      yum:
        name: "{{ mysql_packages }}"
        state: present
        update_cache: True
      register: task_result
      until: task_result is success
      retries: 10
      delay: 2
  become: True

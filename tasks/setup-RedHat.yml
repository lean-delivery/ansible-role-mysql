---
- name: Add {{ mysql_daemon }} {{ mysql_version }} YUM repository file
  yum_repository:
    name: '{{ mysql_daemon }}'
    description: mysql YUM repo
    baseurl: '{{ mysql_repo }}'
    gpgcakey: '{{ mysql_gpgkey }}'
    gpgcheck: True

- name:
  rpm_key:
    state: present
    key: '{{ mysql_gpgkey }}'

- name: Ensure MySQL Python libraries are installed.
  yum:
    name: "{{ item }}"
    state: present
  with_items:
    - MySQL-python
    - perl-DBD-MySQL

- name: Install {{ mysql_daemon }} {{ mysql_version }} packages.
  yum:
    name: "{{ mysql_packages }}"
    state: present
    update_cache: True
  register: mysql_installed_packages

- name: Enable it to start automatically at the next boot
  service:
    name: '{{ mysql_daemon }}'
    state: started
    enabled: '{{ mysql_enabled_on_startup }}'
    runlevel: 235

- name: find temporary password
  become: True
  slurp:
    src: "/var/log/mysqld.log"
  register: log_content

- name: debug
  debug:
    msg: "{{ log_content['content'] | b64decode |\
         regex_replace('.*root@localhost:\\ (\\S+)', '\\\\1') }}"

---
- name: Add {{ mysql_daemon }} {{ mysql_version }} YUM repository file
  become: True
  yum_repository:
    name: '{{ mysql_daemon }}'
    description: mysql YUM repo
    baseurl: '{{ mysql_repo }}'
    gpgcakey: '{{ mysql_gpgkey }}'
    gpgcheck: True

- name: Add gpgkey
  become: True
  rpm_key:
    state: present
    key: '{{ mysql_gpgkey }}'

- name: Ensure MySQL Python libraries are installed.
  become: True
  yum:
    name: "{{ item }}"
    state: present
  with_items:
    - MySQL-python
    - perl-DBD-MySQL

- name: Install {{ mysql_daemon }} {{ mysql_version }} packages.
  become: True
  yum:
    name: "{{ mysql_packages }}"
    state: present
    update_cache: True
  register: mysql_installed_packages

- name: Enable it to start automatically at the next boot
  become: True
  service:
    name: '{{ mysql_daemon }}'
    state: started
    enabled: '{{ mysql_enabled_on_startup }}'
    runlevel: 235

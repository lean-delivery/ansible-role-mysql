---
# This is an example playbook to execute Ansible tests.

- name: Verify
  hosts: all
  tasks:

    - name: Populate service facts
      service_facts:

    - name: Gather facts on listening ports
      listen_ports_facts:

    - name: Assert that mysql service is running
      assert:
        that: |
          "'running' in ansible_facts.services['mysqld.service'].state"
          or
          "'running' in ansible_facts.services['mariadb.service'].state"
          or
          "'running' in ansible_facts.services['mysql.service'].state"

          ansible_facts.tcp_listen  | map(attribute='port') | sort | list

    - name: debug ansible_facts.tcp_listen.port
      debug:
        var: ansible_facts.tcp_listen.port

    - name: Assert that mysql port is listening
      assert:
        that:
          "'3306' in ansible_facts.tcp_listen.port"
